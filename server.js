

import fetch from 'isomorphic-fetch';
import groupBy from 'lodash.groupby';
import url from 'url';
import {
  API_RAIL_STATIONS,
  API_RAIL_LINES,
  API_TRAIN_POSITIONS,
  TRAIN_POSITIONS,
  RAIL_ALERTS,
  API_RAIL_ALERTS,
  RAIL_PREDICTIONS,
  API_RAIL_PREDICTIONS,
} from './common/constants/urls';
import {
  LINE_MERGES,
} from './common/constants/lines';
import { 
  snapStations,
  snapTrains,
} from './utils';
import { railLines, railStations } from './common/data/CleanMetroData';
import express from 'express';
import path from 'path';
import dotenv from 'dotenv';
import runApp from './runApp';
import bindEndpoints from './bindEndpoints';
dotenv.config();

const API_KEY = process.env.API_KEY;

if (!API_KEY) {
  console.log('\x1b[31m', 'You MUST provide a WMATA api key as an environment variable. e.g: "API_KEY=<####> yarn dev"');
  console.log('\x1b[33m', 'You can get one here: https://developer.wmata.com/signup/`');
  process.exit(1);
}

const app = express();
const DEFAULT_PORT = 5001;
const port = process.env.PORT || DEFAULT_PORT;

bindEndpoints(app);
runApp(app, port);

// The API is some trash so sometimes it doesn't return every train.
const potentiallyClearedTrainITTMap = {};
const snappedStations = snapStations(railLines, railStations);
let trains = [];
let railPredictions = [
  //{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A07","LocationName":"Tenleytown-AU","Min":"BRD"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A12","LocationName":"White Flint","Min":"BRD"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B04","LocationName":"Rhode Island Ave-Brentwood","Min":"BRD"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C03","LocationName":"Farragut West","Min":"BRD"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"C07","LocationName":"Pentagon","Min":"BRD"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C13","LocationName":"King St-Old Town","Min":"BRD"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"D03","LocationName":"L'Enfant Plaza","Min":"BRD"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E01","LocationName":"Mt Vernon Sq 7th St-Convention Center","Min":"BRD"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F02","LocationName":"Archives-Navy Memorial-Penn Quarter","Min":"BRD"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F09","LocationName":"Naylor Road","Min":"BRD"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"N04","LocationName":"Spring Hill","Min":"BRD"},{"Car":null,"Destination":"ssenger","DestinationCode":null,"DestinationName":"No Passenger","Group":"1","Line":"No","LocationCode":"A14","LocationName":"Rockville","Min":"ARR"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B02","LocationName":"Judiciary Square","Min":"ARR"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C01","LocationName":"Metro Center","Min":"ARR"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C10","LocationName":"Ronald Reagan Washington National Airport","Min":"ARR"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D01","LocationName":"Federal Triangle","Min":"ARR"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"D06","LocationName":"Eastern Market","Min":"ARR"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E08","LocationName":"Prince George's Plaza","Min":"ARR"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K01","LocationName":"Court House","Min":"ARR"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A10","LocationName":"Medical Center","Min":"1"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"C05","LocationName":"Rosslyn","Min":"1"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D08","LocationName":"Stadium-Armory","Min":"1"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D10","LocationName":"Deanwood","Min":"1"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"E03","LocationName":"U Street/African-Amer Civil War Memorial/Cardozo","Min":"1"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"YL","LocationCode":"E06","LocationName":"Fort Totten","Min":"1"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"E07","LocationName":"West Hyattsville","Min":"1"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"K04","LocationName":"Ballston-MU","Min":"1"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A06","LocationName":"Van Ness-UDC","Min":"2"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B01","LocationName":"Gallery Pl-Chinatown","Min":"2"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B05","LocationName":"Brookland-CUA","Min":"2"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B08","LocationName":"Silver Spring","Min":"2"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"C01","LocationName":"Metro Center","Min":"2"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C04","LocationName":"Foggy Bottom-GWU","Min":"2"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C10","LocationName":"Ronald Reagan Washington National Airport","Min":"2"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"D01","LocationName":"Federal Triangle","Min":"2"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"D04","LocationName":"Federal Center SW","Min":"2"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"D05","LocationName":"Capitol South","Min":"2"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E02","LocationName":"Shaw-Howard U","Min":"2"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F03","LocationName":"L'Enfant Plaza","Min":"2"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"G01","LocationName":"Benning Road","Min":"2"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K02","LocationName":"Clarendon","Min":"2"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A01","LocationName":"Metro Center","Min":"3"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A11","LocationName":"Grosvenor-Strathmore","Min":"3"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"C02","LocationName":"McPherson Square","Min":"3"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"D02","LocationName":"Smithsonian","Min":"3"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"D05","LocationName":"Capitol South","Min":"3"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"D08","LocationName":"Stadium-Armory","Min":"3"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D09","LocationName":"Minnesota Ave","Min":"3"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"E02","LocationName":"Shaw-Howard U","Min":"3"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E03","LocationName":"U Street/African-Amer Civil War Memorial/Cardozo","Min":"3"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E09","LocationName":"College Park-U of Md","Min":"3"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F08","LocationName":"Southern Avenue","Min":"3"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"K03","LocationName":"Virginia Square-GMU","Min":"3"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A05","LocationName":"Cleveland Park","Min":"4"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B07","LocationName":"Takoma","Min":"4"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"C04","LocationName":"Foggy Bottom-GWU","Min":"4"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C05","LocationName":"Rosslyn","Min":"4"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C09","LocationName":"Crystal City","Min":"4"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"D04","LocationName":"Federal Center SW","Min":"4"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"E01","LocationName":"Mt Vernon Sq 7th St-Convention Center","Min":"4"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F04","LocationName":"Waterfront","Min":"4"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"K02","LocationName":"Clarendon","Min":"4"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K03","LocationName":"Virginia Square-GMU","Min":"4"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A02","LocationName":"Farragut North","Min":"5"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A11","LocationName":"Grosvenor-Strathmore","Min":"5"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B06","LocationName":"Fort Totten","Min":"5"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"C03","LocationName":"Farragut West","Min":"5"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"C03","LocationName":"Farragut West","Min":"5"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C12","LocationName":"Braddock Road","Min":"5"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"D03","LocationName":"L'Enfant Plaza","Min":"5"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"D03","LocationName":"L'Enfant Plaza","Min":"5"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"D06","LocationName":"Eastern Market","Min":"5"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"D07","LocationName":"Potomac Ave","Min":"5"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D09","LocationName":"Minnesota Ave","Min":"5"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E04","LocationName":"Columbia Heights","Min":"5"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"E06","LocationName":"Fort Totten","Min":"5"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"YL","LocationCode":"E07","LocationName":"West Hyattsville","Min":"5"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"F03","LocationName":"L'Enfant Plaza","Min":"5"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F07","LocationName":"Congress Heights","Min":"5"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"G02","LocationName":"Capitol Heights","Min":"5"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K04","LocationName":"Ballston-MU","Min":"5"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A04","LocationName":"Woodley Park-Zoo/Adams Morgan","Min":"6"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A10","LocationName":"Medical Center","Min":"6"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C08","LocationName":"Pentagon City","Min":"6"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"D04","LocationName":"Federal Center SW","Min":"6"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"F01","LocationName":"Gallery Pl-Chinatown","Min":"6"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F05","LocationName":"Navy Yard-Ballpark","Min":"6"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"J02","LocationName":"Van Dorn Street","Min":"6"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"K01","LocationName":"Court House","Min":"6"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A03","LocationName":"Dupont Circle","Min":"7"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A12","LocationName":"White Flint","Min":"7"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B06","LocationName":"Fort Totten","Min":"7"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"C02","LocationName":"McPherson Square","Min":"7"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"C04","LocationName":"Foggy Bottom-GWU","Min":"7"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C06","LocationName":"Arlington Cemetery","Min":"7"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C13","LocationName":"King St-Old Town","Min":"7"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"D02","LocationName":"Smithsonian","Min":"7"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"D06","LocationName":"Eastern Market","Min":"7"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"D07","LocationName":"Potomac Ave","Min":"7"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D08","LocationName":"Stadium-Armory","Min":"7"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D10","LocationName":"Deanwood","Min":"7"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"E05","LocationName":"Georgia Ave-Petworth","Min":"7"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"YL","LocationCode":"E08","LocationName":"Prince George's Plaza","Min":"7"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"F02","LocationName":"Archives-Navy Memorial-Penn Quarter","Min":"7"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F06","LocationName":"Anacostia","Min":"7"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"G03","LocationName":"Addison Road-Seat Pleasant","Min":"7"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A03","LocationName":"Dupont Circle","Min":"8"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A09","LocationName":"Bethesda","Min":"8"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B07","LocationName":"Takoma","Min":"8"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"C01","LocationName":"Metro Center","Min":"8"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C07","LocationName":"Pentagon","Min":"8"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"D05","LocationName":"Capitol South","Min":"8"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E05","LocationName":"Georgia Ave-Petworth","Min":"8"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"F01","LocationName":"Gallery Pl-Chinatown","Min":"8"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"F02","LocationName":"Archives-Navy Memorial-Penn Quarter","Min":"8"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F06","LocationName":"Anacostia","Min":"8"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A04","LocationName":"Woodley Park-Zoo/Adams Morgan","Min":"9"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"C05","LocationName":"Rosslyn","Min":"9"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"C05","LocationName":"Rosslyn","Min":"9"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C14","LocationName":"Eisenhower Avenue","Min":"9"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"D01","LocationName":"Federal Triangle","Min":"9"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"D05","LocationName":"Capitol South","Min":"9"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D07","LocationName":"Potomac Ave","Min":"9"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"D08","LocationName":"Stadium-Armory","Min":"9"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"F03","LocationName":"L'Enfant Plaza","Min":"9"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K05","LocationName":"East Falls Church","Min":"9"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A02","LocationName":"Farragut North","Min":"10"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A13","LocationName":"Twinbrook","Min":"10"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B05","LocationName":"Brookland-CUA","Min":"10"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"C01","LocationName":"Metro Center","Min":"10"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C06","LocationName":"Arlington Cemetery","Min":"10"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C07","LocationName":"Pentagon","Min":"10"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"G04","LocationName":"Morgan Boulevard","Min":"10"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D01","LocationName":"Federal Triangle","Min":"10"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"D04","LocationName":"Federal Center SW","Min":"10"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"D06","LocationName":"Eastern Market","Min":"10"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D11","LocationName":"Cheverly","Min":"10"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"E01","LocationName":"Mt Vernon Sq 7th St-Convention Center","Min":"10"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"E04","LocationName":"Columbia Heights","Min":"10"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E06","LocationName":"Fort Totten","Min":"10"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"YL","LocationCode":"E09","LocationName":"College Park-U of Md","Min":"10"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F05","LocationName":"Navy Yard-Ballpark","Min":"10"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A05","LocationName":"Cleveland Park","Min":"11"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A08","LocationName":"Friendship Heights","Min":"11"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B08","LocationName":"Silver Spring","Min":"11"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"C04","LocationName":"Foggy Bottom-GWU","Min":"11"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C08","LocationName":"Pentagon City","Min":"11"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D02","LocationName":"Smithsonian","Min":"11"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D06","LocationName":"Eastern Market","Min":"11"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"D07","LocationName":"Potomac Ave","Min":"11"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F07","LocationName":"Congress Heights","Min":"11"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A01","LocationName":"Metro Center","Min":"12"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"C02","LocationName":"McPherson Square","Min":"12"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"D03","LocationName":"L'Enfant Plaza","Min":"12"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D12","LocationName":"Landover","Min":"12"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"E02","LocationName":"Shaw-Howard U","Min":"12"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"E03","LocationName":"U Street/African-Amer Civil War Memorial/Cardozo","Min":"12"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F04","LocationName":"Waterfront","Min":"12"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"K01","LocationName":"Court House","Min":"12"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A06","LocationName":"Van Ness-UDC","Min":"13"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A07","LocationName":"Tenleytown-AU","Min":"13"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A14","LocationName":"Rockville","Min":"13"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B04","LocationName":"Rhode Island Ave-Brentwood","Min":"13"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"C03","LocationName":"Farragut West","Min":"13"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"C03","LocationName":"Farragut West","Min":"13"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C05","LocationName":"Rosslyn","Min":"13"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C09","LocationName":"Crystal City","Min":"13"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D03","LocationName":"L'Enfant Plaza","Min":"13"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D05","LocationName":"Capitol South","Min":"13"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"D08","LocationName":"Stadium-Armory","Min":"13"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"E02","LocationName":"Shaw-Howard U","Min":"13"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"E03","LocationName":"U Street/African-Amer Civil War Memorial/Cardozo","Min":"13"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F08","LocationName":"Southern Avenue","Min":"13"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"G01","LocationName":"Benning Road","Min":"13"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"K02","LocationName":"Clarendon","Min":"13"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B01","LocationName":"Gallery Pl-Chinatown","Min":"14"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B09","LocationName":"Forest Glen","Min":"14"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C07","LocationName":"Pentagon","Min":"14"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"D02","LocationName":"Smithsonian","Min":"14"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D04","LocationName":"Federal Center SW","Min":"14"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D04","LocationName":"Federal Center SW","Min":"14"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E07","LocationName":"West Hyattsville","Min":"14"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F03","LocationName":"L'Enfant Plaza","Min":"14"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B02","LocationName":"Judiciary Square","Min":"15"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B35","LocationName":"NoMa-Gallaudet","Min":"15"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"C02","LocationName":"McPherson Square","Min":"15"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"C04","LocationName":"Foggy Bottom-GWU","Min":"15"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C10","LocationName":"Ronald Reagan Washington National Airport","Min":"15"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"D01","LocationName":"Federal Triangle","Min":"15"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"E01","LocationName":"Mt Vernon Sq 7th St-Convention Center","Min":"15"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"K03","LocationName":"Virginia Square-GMU","Min":"15"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"N01","LocationName":"McLean","Min":"15"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A06","LocationName":"Van Ness-UDC","Min":"16"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A07","LocationName":"Tenleytown-AU","Min":"16"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"C01","LocationName":"Metro Center","Min":"16"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C01","LocationName":"Metro Center","Min":"16"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C04","LocationName":"Foggy Bottom-GWU","Min":"16"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C08","LocationName":"Pentagon City","Min":"16"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D03","LocationName":"L'Enfant Plaza","Min":"16"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D05","LocationName":"Capitol South","Min":"16"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"E04","LocationName":"Columbia Heights","Min":"16"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E08","LocationName":"Prince George's Plaza","Min":"16"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F02","LocationName":"Archives-Navy Memorial-Penn Quarter","Min":"16"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F09","LocationName":"Naylor Road","Min":"16"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"G02","LocationName":"Capitol Heights","Min":"16"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A05","LocationName":"Cleveland Park","Min":"17"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B03","LocationName":"Union Station","Min":"17"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B03","LocationName":"Union Station","Min":"17"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B10","LocationName":"Wheaton","Min":"17"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C03","LocationName":"Farragut West","Min":"17"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"F01","LocationName":"Gallery Pl-Chinatown","Min":"17"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F01","LocationName":"Gallery Pl-Chinatown","Min":"17"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"K04","LocationName":"Ballston-MU","Min":"17"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"N02","LocationName":"Tysons Corner","Min":"17"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A08","LocationName":"Friendship Heights","Min":"18"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C02","LocationName":"McPherson Square","Min":"18"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"C05","LocationName":"Rosslyn","Min":"18"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C09","LocationName":"Crystal City","Min":"18"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"D01","LocationName":"Federal Triangle","Min":"18"},{"Car":"6","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"D02","LocationName":"Smithsonian","Min":"18"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D06","LocationName":"Eastern Market","Min":"18"},{"Car":"8","Destination":"Ft.Tottn","DestinationCode":"E06","DestinationName":"Fort Totten","Group":"1","Line":"YL","LocationCode":"E05","LocationName":"Georgia Ave-Petworth","Min":"18"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F02","LocationName":"Archives-Navy Memorial-Penn Quarter","Min":"18"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"G01","LocationName":"Benning Road","Min":"18"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"G03","LocationName":"Addison Road-Seat Pleasant","Min":"18"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A04","LocationName":"Woodley Park-Zoo/Adams Morgan","Min":"19"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B02","LocationName":"Judiciary Square","Min":"19"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"C02","LocationName":"McPherson Square","Min":"19"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"D02","LocationName":"Smithsonian","Min":"19"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D07","LocationName":"Potomac Ave","Min":"19"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E01","LocationName":"Mt Vernon Sq 7th St-Convention Center","Min":"19"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E09","LocationName":"College Park-U of Md","Min":"19"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F10","LocationName":"Suitland","Min":"19"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"N03","LocationName":"Greensboro","Min":"19"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B35","LocationName":"NoMa-Gallaudet","Min":"20"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C10","LocationName":"Ronald Reagan Washington National Airport","Min":"20"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C12","LocationName":"Braddock Road","Min":"20"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E02","LocationName":"Shaw-Howard U","Min":"20"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F03","LocationName":"L'Enfant Plaza","Min":"20"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K01","LocationName":"Court House","Min":"20"},{"Car":"8","Destination":"W Fls Ch","DestinationCode":"K06","DestinationName":"West Falls Church-VT/UVA","Group":"2","Line":"OR","LocationCode":"K05","LocationName":"East Falls Church","Min":"20"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A09","LocationName":"Bethesda","Min":"21"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"B01","LocationName":"Gallery Pl-Chinatown","Min":"21"},{"Car":"8","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"SV","LocationCode":"G04","LocationName":"Morgan Boulevard","Min":"21"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"G02","LocationName":"Capitol Heights","Min":"21"},{"Car":"8","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"N04","LocationName":"Spring Hill","Min":"21"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A01","LocationName":"Metro Center","Min":"22"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A03","LocationName":"Dupont Circle","Min":"22"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B04","LocationName":"Rhode Island Ave-Brentwood","Min":"22"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C13","LocationName":"King St-Old Town","Min":"22"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E03","LocationName":"U Street/African-Amer Civil War Memorial/Cardozo","Min":"22"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F04","LocationName":"Waterfront","Min":"22"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K02","LocationName":"Clarendon","Min":"22"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A02","LocationName":"Farragut North","Min":"23"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A10","LocationName":"Medical Center","Min":"23"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"G03","LocationName":"Addison Road-Seat Pleasant","Min":"23"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K03","LocationName":"Virginia Square-GMU","Min":"23"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A02","LocationName":"Farragut North","Min":"24"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B05","LocationName":"Brookland-CUA","Min":"24"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E04","LocationName":"Columbia Heights","Min":"24"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F05","LocationName":"Navy Yard-Ballpark","Min":"24"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C12","LocationName":"Braddock Road","Min":"25"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K04","LocationName":"Ballston-MU","Min":"25"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"A01","LocationName":"Metro Center","Min":"26"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A03","LocationName":"Dupont Circle","Min":"26"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C06","LocationName":"Arlington Cemetery","Min":"26"},{"Car":"6","Destination":"Largo","DestinationCode":"G05","DestinationName":"Largo Town Center","Group":"1","Line":"BL","LocationCode":"G04","LocationName":"Morgan Boulevard","Min":"26"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D09","LocationName":"Minnesota Ave","Min":"26"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E05","LocationName":"Georgia Ave-Petworth","Min":"26"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A11","LocationName":"Grosvenor-Strathmore","Min":"27"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B01","LocationName":"Gallery Pl-Chinatown","Min":"27"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B06","LocationName":"Fort Totten","Min":"27"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F06","LocationName":"Anacostia","Min":"27"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A04","LocationName":"Woodley Park-Zoo/Adams Morgan","Min":"28"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D10","LocationName":"Deanwood","Min":"28"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"J02","LocationName":"Van Dorn Street","Min":"28"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"K05","LocationName":"East Falls Church","Min":"28"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A12","LocationName":"White Flint","Min":"29"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B02","LocationName":"Judiciary Square","Min":"29"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C07","LocationName":"Pentagon","Min":"29"},{"Car":"8","Destination":"Hntingtn","DestinationCode":"C15","DestinationName":"Huntington","Group":"2","Line":"YL","LocationCode":"C14","LocationName":"Eisenhower Avenue","Min":"29"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E06","LocationName":"Fort Totten","Min":"29"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F07","LocationName":"Congress Heights","Min":"29"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A05","LocationName":"Cleveland Park","Min":"30"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B07","LocationName":"Takoma","Min":"30"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D11","LocationName":"Cheverly","Min":"30"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B03","LocationName":"Union Station","Min":"31"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C08","LocationName":"Pentagon City","Min":"31"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A06","LocationName":"Van Ness-UDC","Min":"32"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A13","LocationName":"Twinbrook","Min":"32"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F08","LocationName":"Southern Avenue","Min":"32"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B08","LocationName":"Silver Spring","Min":"33"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B35","LocationName":"NoMa-Gallaudet","Min":"33"},{"Car":"6","Destination":"Frnconia","DestinationCode":"J03","DestinationName":"Franconia-Springfield","Group":"2","Line":"BL","LocationCode":"C09","LocationName":"Crystal City","Min":"33"},{"Car":"8","Destination":"NewCrltn","DestinationCode":"D13","DestinationName":"New Carrollton","Group":"1","Line":"OR","LocationCode":"D12","LocationName":"Landover","Min":"33"},{"Car":"8","Destination":"Grnbelt","DestinationCode":"E10","DestinationName":"Greenbelt","Group":"1","Line":"GR","LocationCode":"E07","LocationName":"West Hyattsville","Min":"33"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F09","LocationName":"Naylor Road","Min":"34"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A07","LocationName":"Tenleytown-AU","Min":"35"},{"Car":"6","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A14","LocationName":"Rockville","Min":"35"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"N01","LocationName":"McLean","Min":"35"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B04","LocationName":"Rhode Island Ave-Brentwood","Min":"36"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B09","LocationName":"Forest Glen","Min":"36"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A08","LocationName":"Friendship Heights","Min":"37"},{"Car":"8","Destination":"Brnch Av","DestinationCode":"F11","DestinationName":"Branch Ave","Group":"2","Line":"GR","LocationCode":"F10","LocationName":"Suitland","Min":"37"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"N02","LocationName":"Tysons Corner","Min":"37"},{"Car":"6","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B05","LocationName":"Brookland-CUA","Min":"38"},{"Car":"8","Destination":"Glenmont","DestinationCode":"B11","DestinationName":"Glenmont","Group":"1","Line":"RD","LocationCode":"B10","LocationName":"Wheaton","Min":"39"},{"Car":"6","Destination":"Wiehle","DestinationCode":"N06","DestinationName":"Wiehle-Reston East","Group":"2","Line":"SV","LocationCode":"N03","LocationName":"Greensboro","Min":"39"},{"Car":"8","Destination":"Shady Gr","DestinationCode":"A15","DestinationName":"Shady Grove","Group":"2","Line":"RD","LocationCode":"A09","LocationName":"Bethesda","Min":"40"},{"Car":null,"Destination":"ssenger","DestinationCode":null,"DestinationName":"No Passenger","Group":"2","Line":"No","LocationCode":"G04","LocationName":"Morgan Boulevard","Min":"---"}
];
let railAlerts = [
  //{"IncidentID":"8F2E1A3D-8528-4C06-AA20-1594617187D1","Description":"Red Line: Trains operate every 20-25 min w/ single tracking btwn Farragut North & Judiciary Square due to scheduled track work.","StartLocationFullName":null,"EndLocationFullName":null,"PassengerDelay":0.0,"DelaySeverity":null,"IncidentType":"Alert","EmergencyText":null,"LinesAffected":"RD;OR;YL;GR;BL;SV;","DateUpdated":"2018-06-08T22:25:10"},
  //{"IncidentID":"FDB0A82A-2B8D-40A5-A5CF-7686B1EBA812","Description":"Orange Line: Dunn Loring & Vienna stations are closed due to scheduled maintenance.","StartLocationFullName":null,"EndLocationFullName":null,"PassengerDelay":0,"DelaySeverity":null,"IncidentType":"Delay","EmergencyText":null,"LinesAffected":"OR;","DateUpdated":"2018-06-09T06:58:49"},
  //{"IncidentID":"502D77F1-099B-4245-A5C4-25B7A3AA7D24","Description":"Orange Line: Thru Sunday's closing, buses replace trains btwn Vienna & West Falls Church due to scheduled maintenance.","StartLocationFullName":null,"EndLocationFullName":null,"PassengerDelay":0,"DelaySeverity":null,"IncidentType":"Alert","EmergencyText":null,"LinesAffected":"OR;","DateUpdated":"2018-06-09T06:56:24"},
];

const fetchTrains = async () => {
  let nextTrains = await fetch(TRAIN_POSITIONS, {
    method: 'GET',
    headers: {
      Accept: 'application/json'
      //'Content-Type': 'application/json'
    }
  });
  nextTrains = await nextTrains.json();
  trains = snapTrains(railLines, nextTrains, trains, potentiallyClearedTrainITTMap);
};

const fetchRailAlerts = async () => {
  let res = await fetch(RAIL_ALERTS + process.env.API_KEY, {
    method: 'GET',
    headers: {
      Accept: 'application/json'
    }
  });
  res = await res.json();
  railAlerts = res["Incidents"];
};

const fetchRailPredictions = async () => {
  let res = await fetch(RAIL_PREDICTIONS + process.env.API_KEY, {
    method: 'GET',
    headers: {
      Accept: 'application/json'
    }
  });
  res = await res.json();
  railPredictions = res["Trains"];
};

fetchTrains();
fetchRailAlerts();
fetchRailPredictions();
setInterval(fetchTrains, 4000);
setInterval(fetchRailAlerts, 10000);
setInterval(fetchRailPredictions, 4000);

app.get(API_RAIL_STATIONS, (req, res) => {
  res.send(snappedStations);
});

app.get(API_RAIL_LINES, (req, res) => {
  res.send(railLines);
});

app.get(API_TRAIN_POSITIONS, (req, res) => {
  res.send(trains);
});

app.get(API_RAIL_ALERTS, (req, res) => {
  res.send(railAlerts);
});

app.get(API_RAIL_PREDICTIONS, (req, res) => {
  console.log('>>>>>>>>>>>>>>>>');
  const urlParts = url.parse(req.url, true);
  const stationCodes = urlParts['query']['stationCodes'].split(',');
  const toReturn = railPredictions.filter(({LocationCode}) => {
    return stationCodes.indexOf(LocationCode) > -1;
  });
  console.log(groupBy(toReturn, 'Group'))
  res.send(groupBy(toReturn, 'Group'));
});

app.use(express.static(__dirname + '/client/build'));

app.get('/*', (req, res) => {
  res.sendFile(path.join(__dirname + '/client/build/index.html'));
});